<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <!-- Add favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèÜ</text></svg>">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS Variables for Deep Dark Purple Theme with Tron Blue Highlights */
        :root {
            /* Our seven approved blue colors */
            --blue-1: #000000;  /* Darkest-black tiny*/
            --blue-2: #000036; /* Very Dark Blue */
            --blue-3: #02066F; /* Dark Blue */
            --blue-4: #170484; /* Dark Blue with Deep Hue */
            --blue-5: #050c91; /* 050c91 */
            --blue-6: #001489; /* Pantone Reflex Blue C Color */
            --blue-7: #0000B3;  /* Brightest: Bright Blue */

            /* Single background gradient using approved colors */
            --background-gradient: linear-gradient(
                to bottom,
                var(--blue-1) 0%,
                var(--blue-2) 5%,
                var(--blue-3) 20%,
                var(--blue-4) 35%,
                var(--blue-5) 50%,
                var(--blue-6) 75%,
                var(--blue-7) 100%
            );

            /* Remove unused gradient variables */
            --background-gradient-odd: none;
            --background-gradient-even: none;

            /* Update other gradients to use only approved colors */
            --primary-gradient: linear-gradient(
                to bottom,
                var(--blue-1) 0%,
                var(--blue-4) 50%,
                var(--blue-7) 100%
            );
            
            --secondary-gradient: linear-gradient(
                to bottom,
                var(--blue-1) 0%,
                var(--blue-3) 50%,
                var(--blue-7) 100%
            );
            
            --task-form-gradient: linear-gradient(
                to bottom,
                rgba(0, 0, 105, 0.95) 0%,    /* Based on #000069 */
                rgba(27, 2, 177, 0.95) 100%   /* Based on #1b02b1 */
            );

            /* Keep existing non-blue colors */
            --text-color: #FFD700;
            --muted-text: #FFA500;
            --bright-text: #FFDF00;
            --header-gradient: linear-gradient(
                to bottom,
                #FFD700 0%,
                #FFA500 100%
            );

            /* Other non-gradient variables remain unchanged */
            --card-background: rgba(255, 255, 255, 0.05);
            --overlay-background: rgba(255, 255, 255, 0.02);
            --error-color: #ff4d4d;
            --success-color: #4caf50;
            --font-primary: 'Montserrat', sans-serif;
            --font-secondary: 'Roboto', sans-serif;
            --box-shadow: 0 8px 32px 0 rgba(0, 0, 105, 0.37);
            --backdrop-filter: blur(8px);
            --border-radius: 12px;
            --transition-speed: 0.3s;

            /* Animation Durations */
            --animation-duration-pulse: 0.6s;
            --animation-duration-shine: 1s;
            --animation-duration-confetti: 1.5s;
        }

        /* Basic Reset and Styling */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-secondary);
            font-size: 24px;
            background: var(--background-gradient);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Changed from center to flex-start */
            padding: 10px;
            position: relative;
            /* Removed overflow: hidden; to enable scrolling */
            overflow: visible;
            padding-top: 60px; /* Adjust padding to account for fixed navbar */
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            backdrop-filter: var(--backdrop-filter);
            padding: 1.5rem;
            animation: fadeIn 0.6s ease-out;
            display: flex;
            flex-direction: column;
            gap: 2rem;
            position: relative;
            overflow: visible !important;
        }

        .container::-webkit-scrollbar {
            width: 10px;
        }

        .container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }

        .container::-webkit-scrollbar-thumb {
            background: var(--primary-gradient);
            border-radius: 5px;
        }

        .container::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-gradient);
        }

        /* Header Component */
        .header {
            text-align: center;
            position: relative;
            padding: 1rem 3rem;
            margin: 0;
            background: none;
            backdrop-filter: none;
            z-index: 1;
        }

        .header .title {
            font-family: var(--font-primary);
            font-size: 1.4rem;
            margin-bottom: 0.5rem;
            background: var(--header-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            transition: background 0.5s ease;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            position: relative;
            z-index: 9999;
        }

        .header p {
            display: none; /* Hide the subtext */
        }

        /* Stats Component */
        .stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 1rem;
            position: relative;
            z-index: 1;
        }

        .stats div {
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--overlay-background);
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
            flex: 1 1 150px;
            text-align: center;
            cursor: default;
            color: var(--bright-text);
            position: relative;
        }

        .stats div:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        /* Progress Bar Component */
        .progress-container {
            width: 100%;
            position: relative;
            z-index: 1;
        }

        .progress-bar {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            overflow: hidden;
            height: 20px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
            position: relative;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: var(--header-gradient);
            transition: width 0.4s ease;
            box-shadow: 0 0 10px var(--primary-gradient);
        }

        .progress-text {
            text-align: center;
            margin-top: 0.5rem;
            font-size: 1.3rem;
            color: var(--muted-text);
            font-weight: 500;
        }

        /* Task Form Component */
        .task-form {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: stretch;
            background: var(--task-form-gradient);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: background 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            z-index: 1;
        }

        .task-form:hover {
            background: linear-gradient(
                135deg,
                rgba(0, 0, 51, 1) 0%,
                rgba(25, 25, 112, 1) 100%
            );
        }

        .task-form input[type="text"] {
            flex: 2;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 8px;
            font-size: 1.3rem;
            outline: none;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            transition: background-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
        }

        .task-form input[type="text"]::placeholder {
            color: rgba(255, 215, 0, 0.6);
        }

        .task-form input[type="text"]:focus {
            background-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 8px var(--primary-gradient);
        }

        .task-form select {
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            color: var (--text-color);
            font-size: 1.5rem;
            font-weight: 400;
            width: auto;
            cursor: pointer;
            transition: background-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
            outline: none;
        }

        .task-form select:focus {
            background-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 8px var(--secondary-gradient);
        }

        .task-form button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            background: var(--primary-gradient);
            color: #fff;
            font-size: 1.3rem;
            cursor: pointer;
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease, background 0.5s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .task-form button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
            background: var(--secondary-gradient);
        }

        /* Task Lists Component */
        .task-list {
            background: var(--overlay-background);
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: background 0.3s ease;
            position: relative;
            z-index: 1;
        }

        /* Add specific styling for completed tasks list only */
        #completedTasksList {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        /* Keep the scrollbar styling only for completed tasks */
        #completedTasksList::-webkit-scrollbar {
            width: 10px;
        }

        #completedTasksList::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }

        #completedTasksList::-webkit-scrollbar-thumb {
            background: var(--primary-gradient);
            border-radius: 5px;
        }

        #completedTasksList::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-gradient);
        }

        .task-list h3 {
            margin-bottom: 1rem;
            font-size: 1.5rem;
            color: var(--header-gradient);
            background: var(--header-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }

        /* Task Item Component */
        .task-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease, background-color var(--transition-speed) ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transform: translateZ(0);
            position: relative;
            flex-wrap: wrap; /* Allow items to wrap */
        }

        .task-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            background-color: rgba(255, 255, 255, 0.1);
        }

        .task-details {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
            min-width: 200px;
            position: relative;
        }

        .task-details input[type="checkbox"] {
            width: 1.5rem;
            height: 1.5rem;
            cursor: pointer;
            accent-color: var(--primary-gradient);
            transition: transform var(--transition-speed) ease;
        }

        .task-details input[type="checkbox"]:hover {
            transform: scale(1.2);
        }

        .task-text {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-color);
            font-size: 1.3rem;
            outline: none;
            cursor: text;
            transition: color var(--transition-speed) ease;
            font-family: var(--font-secondary);
            word-break: break-word; /* Allow words to break */
            white-space: normal; /* Allow text to wrap */
            line-height: 1.4; /* Better line height for readability */
            min-height: 2.8em; /* Accommodate up to 2 lines */
            max-width: 100%; /* Ensure text doesn't overflow */
        }

        .task-text:disabled {
            color: var(--muted-text);
            cursor: not-allowed;
        }

        .task-text.completed {
            text-decoration: line-through;
            color: var(--muted-text);
        }

        .task-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .task-actions select {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 1.3rem;
            cursor: pointer;
            transition: background-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
            outline: none;
        }

        .task-actions select:hover {
            background-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .task-actions button {
            background: none;
            border: none;
            color: var(--blue-7); /* Replace #1e90ff with our brightest blue */
            cursor: pointer;
            font-size: 1.3rem;
            transition: color var(--transition-speed) ease, transform var(--transition-speed) ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .task-actions button:hover {
            color: #ffffff;
            transform: scale(1.2);
        }

        /* Reset Button Component */
        .reset-button {
            width: 100%;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            background: var(--primary-gradient);
            color: var(--bright-text);
            font-size: 1.3rem;
            cursor: pointer;
            transition: transform var(--transition-speed) ease, box-shadow var (--transition-speed) ease, background 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .reset-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
            background: var(--secondary-gradient);
        }

        /* Modal Component */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000;
            padding-top: 100px;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            animation: fadeIn 0.6s ease-out;
        }

        .modal-content {
            background-color: rgba(255, 255, 255, 0.05);
            margin: auto;
            padding: 2.5rem;
            border: none;
            width: 80%;
            max-width: 500px;
            border-radius: var(--border-radius);
            position: relative;
            text-align: center;
            box-shadow: var(--box-shadow);
            backdrop-filter: var(--backdrop-filter);
            animation: slideDown 0.6s ease-out;
            color: var(--text-color);
        }

        .close-modal {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: color var(--transition-speed) ease, transform var(--transition-speed) ease;
        }

        .close-modal:hover,
        .close-modal:focus {
            color: #fff;
            transform: rotate(90deg);
        }

        /* Confirmation Modal Component */
        .confirm-modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1500;
            padding-top: 100px;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.6s ease-out;
        }

        .confirm-modal-content {
            background-color: rgba(255, 255, 255, 0.05);
            margin: auto;
            padding: 2.5rem;
            border: none;
            width: 80%;
            max-width: 400px;
            border-radius: var(--border-radius);
            text-align: center;
            position: relative;
            box-shadow: var(--box-shadow);
            backdrop-filter: var(--backdrop-filter);
            animation: slideDown 0.6s ease-out;
            color: var(--text-color);
        }

        .confirm-modal-buttons {
            margin-top: 2rem;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .confirm-modal-buttons button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1.3rem;
            cursor: pointer;
            transition: background-color var(--transition-speed) ease, transform var(--transition-speed) ease;
            width: 45%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .confirm-modal-buttons .confirm {
            background: var(--primary-gradient);
            color: #fff;
        }

        .confirm-modal-buttons .confirm:hover {
            background: var(--secondary-gradient);
            transform: translateY(-3px);
        }

        .confirm-modal-buttons .cancel {
            background-color: rgba(255, 255, 255, 0.05);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .confirm-modal-buttons .cancel:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
        }

        /* Confetti Container */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2000;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--bright-text);
            opacity: 0.9;
            animation: confetti var(--animation-duration-confetti) linear forwards;
            border-radius: 50%; /* Make confetti circular */
        }

        /* Animations */

        /* Fade In */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Slide Down */
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Pulse Animation for Completed Tasks */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse var(--animation-duration-pulse) ease;
        }

        /* Counting Animation for Points and Completed Tasks */
        /* Handled via JavaScript */

        /* Shine Animation for Level Up */
        @keyframes shine {
            0% {
                box-shadow: 0 0 10px var(--success-color);
            }
            50% {
                box-shadow: 0 0 20px var(--success-color);
            }
            100% {
                box-shadow: 0 0 10px var(--success-color);
            }
        }

        .shine {
            animation: shine var(--animation-duration-shine) ease-in-out;
        }

        /* Level Up Badge Animation */
        @keyframes scaleUp {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 0; }
        }

        .level-up-badge {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.5rem 1rem;
            background: var(--success-color);
            color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            opacity: 0;
            animation: scaleUp 1s forwards;
            z-index: 1001;
            font-weight: bold;
        }

        /* Confetti Animation */
        @keyframes confetti {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Confetti Styles */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2000;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--bright-text);
            opacity: 0.9;
            animation: confetti var(--animation-duration-confetti) linear forwards;
            border-radius: 50%; /* Make confetti circular */
        }

        /* Optional: Smooth Number Transition */
        .number-transition {
            transition: all 0.5s ease;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
                padding-top: 0; /* Remove top padding since header has its own */
            }

            .header .title {
                font-size: 1.8rem; /* Slightly reduce font size on mobile */
                padding: 0 2rem; /* Add horizontal padding */
            }

            #logoutButton span {
                display: none; /* Hide button text on mobile */
            }

            #logoutButton {
                top: 0.5rem;
                right: 0.5rem;
                border-radius: 50%; /* Make it circular on mobile */
            }
            
            .header p {
                font-size: 1.3rem;
            }

            .stats {
                justify-content: space-between;
            }

            .task-form {
                flex-direction: column;
            }

            .task-form input[type="text"],
            .task-form select,
            .task-form button {
                width: 100%;
            }

            .task-actions {
                flex-direction: column;
                align-items: flex-start;
            }

            .task-actions select,
            .task-actions button {
                width: 100%;
            }

            /* Reorder container elements using flexbox order */
            .container {
                display: flex;
                flex-direction: column;
            }

            .header {
                padding: 1rem;
                padding-top: 3rem; /* Add space above title for logout button */
            }

            .task-form {
                order: 2;
                margin-top: 1.5rem;
            }

            .stats {
                order: 3;
                margin-top: 1.5rem;
            }

            .progress-container {
                order: 4;
            }

            .task-list {
                order: 5;
            }

            #completedTasksList {
                order: 6;
            }

            .reset-button {
                order: 7;
            }

            .navbar-container {
                flex-direction: column;
                align-items: center;
            }

            .search-input {
                width: 100%;
                max-width: 300px;
                margin-top: 10px;
            }

            #logoutButton {
                position: absolute;
                top: 10px;
                right: 10px;
            }

            .task-actions {
                flex-direction: row; /* Keep actions in a single row */
                justify-content: flex-start; /* Align to the start */
                gap: 0.5rem; /* Reduce gap between elements */
                margin-top: 0; /* Remove top margin */
                flex-wrap: nowrap; /* Prevent wrapping */
            }

            .task-actions select {
                width: auto; /* Allow select to shrink */
                min-width: 80px; /* Minimum width for select */
                padding: 0.5rem; /* Reduce padding */
                font-size: 1rem; /* Smaller font size */
            }

            .task-item {
                padding: 0.75rem; /* Reduce overall padding */
            }

            .task-details {
                margin-bottom: 0.5rem; /* Add space between details and actions */
                width: 100%; /* Full width for details */
            }

            /* Custom points input adjustments */
            input[type="number"].custom-points {
                width: 60px; /* Smaller width */
                padding: 0.5rem; /* Reduced padding */
                font-size: 1rem; /* Smaller font size */
            }

            /* Delete button adjustments */
            .task-actions button {
                padding: 0.5rem; /* Reduced padding */
                font-size: 1rem; /* Smaller font size */
                margin: 0; /* Remove margins */
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 1.5rem;
            }

            .header .title {
                font-size: 1.75rem;
            }

            .header p {
                font-size: 1.3rem;
            }

            .stats div {
                font-size: 1.3rem;
            }

            .task-form input[type="text"],
            .task-form select,
            .task-form button {
                padding: 0.6rem 1rem;
                font-size: 1.3rem;
            }

            .task-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .task-details {
                width: 100%;
                margin-bottom: 0.75rem;
            }

            .task-actions {
                width: 100%;
                justify-content: space-between;
            }

            .task-actions select,
            .task-actions button {
                font-size: 1.3rem;
                padding: 0.5rem;
            }

            .progress-text {
                font-size: 1.3rem;
            }

            .confirm-modal-content,
            .modal-content {
                padding: 2rem;
            }

            .confirm-modal-buttons button {
                padding: 0.6rem 1rem;
                font-size: 1.3rem;
                width: 45%;
            }
        }

        /* Login Container Styling */
        #loginContainer {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: var(--background-gradient);
            color: var(--text-color);
        }

        #loginContainer input[type="email"],
        #loginContainer input[type="password"] {
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            border: none;
            width: 300px;
            max-width: 80%;
            font-size: 1.3rem;
            outline: none;
        }

        #loginContainer button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            background: var(--primary-gradient);
            color: #fff;
            cursor: pointer;
            margin-top: 1rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: transform var(--transition-speed) ease, box-shadow var (--transition-speed) ease, background 0.5s ease;
        }

        #loginContainer button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
            background: var(--secondary-gradient);
        }

        #loginError {
            color: var(--error-color);
            margin-top: 1rem;
            display: none;
            font-size: 1.3rem;
        }

        /* Logout Button Styling */
        #logoutButton {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            padding: 0.5rem;
            width: auto;
            min-width: 40px;
            height: 40px;
            justify-content: center;            
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease, background 0.3s ease;
            z-index: 10000;
        }

        #logoutButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
            background: rgba(255, 255, 255, 0.2);
        }

        /* Logout Button Component */
        #logoutButton {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 1.3rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: transform var (--transition-speed) ease, box-shadow var(--transition-speed) ease, background 0.3s ease;
            z-index: 10000;
            min-width: 40px;
            height: 40px;
        }

        #logoutButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
            background: rgba(255, 255, 255, 0.2);
        }

        /* Add these CSS rules in the style section */
        input[type="number"].custom-points {
            font-size: 1.8rem; /* Increase font size */
            font-weight: bold; /* Make it stand out */
            padding: 0.5rem 1rem; /* Adjust padding for better spacing */
            width: 80px; /* Ensure it has enough width to display the number */
            text-align: center; /* Center the number for better readability */
            background-color: rgba(255, 255, 255, 0.1); /* Match the theme */
            color: var(--text-color); /* Consistent with the design */
            border: 1px solid rgba(255, 255, 255, 0.2); /* Optional: a visible border */
            border-radius: 8px; /* Rounded corners to match the style */
            transition: background-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
        }

        input[type="number"].custom-points:focus {
            background-color: rgba(255, 255, 255, 0.2); /* Highlight when focused */
            box-shadow: 0 0 8px var(--primary-gradient); /* Add a subtle glow effect */
            outline: none; /* Remove the default outline */
        }

        /* Custom Points Input Styling */
        input[type="number"].custom-points,
        #customPoints {
            font-size: 1.3rem !important; /* Match the size of other form elements */
            font-weight: 500;
            padding: 0.75rem 1rem;
            width: 120px; /* Increased width for better visibility */
            text-align: center;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            transition: all var(--transition-speed) ease;
            margin: 0;
            height: auto;
            outline: none;
        }

        input[type="number"].custom-points:focus,
        #customPoints:focus {
            background-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 8px var(--primary-gradient);
            outline: none;
        }

        /* Style the number input spinners */
        input[type="number"].custom-points::-webkit-inner-spin-button,
        input[type="number"].custom-points::-webkit-outer-spin-button,
        #customPoints::-webkit-inner-spin-button,
        #customPoints::-webkit-outer-spin-button {
            height: 40px;
            opacity: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            cursor: pointer;
        }

        input[type="number"].custom-points::-webkit-inner-spin-button,
        input[type="number"].custom-points::-webkit-outer-spin-button {
            height: 30px;
            opacity: 1;
        }

        /* Animations */

        /* Pulse Animation for Completed Tasks */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse var(--animation-duration-pulse) ease;
        }

        /* Counting Animation for Points and Completed Tasks */
        /* Handled via JavaScript */

        /* Shine Animation for Level Up */
        @keyframes shine {
            0% {
                box-shadow: 0 0 10px var(--success-color);
            }
            50% {
                box-shadow: 0 0 20px var(--success-color);
            }
            100% {
                box-shadow: 0 0 10px var(--success-color);
            }
        }

        .shine {
            animation: shine var(--animation-duration-shine) ease-in-out;
        }

        /* Level Up Badge Animation */
        @keyframes scaleUp {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 0; }
        }

        .level-up-badge {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.5rem 1rem;
            background: var(--success-color);
            color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            opacity: 0;
            animation: scaleUp 1s forwards;
            z-index: 1001;
            font-weight: bold;
        }

        /* Confetti Animation */
        @keyframes confetti {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Confetti Styles */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2000;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--bright-text);
            opacity: 0.9;
            animation: confetti var(--animation-duration-confetti) linear forwards;
            border-radius: 50%; /* Make confetti circular */
        }

        /* Optional: Smooth Number Transition */
        .number-transition {
            transition: all 0.5s ease;
        }

        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            background: var(--primary-gradient);
            color: #fff;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            z-index: 10000;
            min-height: 60px; /* Ensure consistent height */
            display: flex; /* Add flex display */
            align-items: center; /* Center items vertically */
        }

        .navbar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            width: 100%;
            height: 60px;
        }

        .navbar-title {
            position: absolute;
            left: 20px;
            top: 50%; /* Center vertically */
            transform: translateY(-50%); /* Offset for perfect centering */
            margin: 0; /* Remove any margin */
            line-height: 1; /* Ensure consistent height */
        }

        .search-input {
            padding: 0.5rem;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            outline: none;
            width: 100px;
            transition: width 0.3s ease;
            margin: 0; /* Remove any margin */
            height: 36px; /* Consistent height */
        }

        #logoutButton {
            position: absolute;
            right: 20px;
            top: 50%; /* Center vertically */
            transform: translateY(-50%); /* Offset for perfect centering */
            margin: 0; /* Remove any margin */
            height: 36px; /* Consistent height */
        }

        /* Navbar Styles Update */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: var(--primary-gradient);
            color: #fff;
            z-index: 10000;
            height: 60px; /* Fixed height */
        }

        .navbar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            width: 100%;
            height: 100%;
            position: relative;
        }

        .navbar-title {
            font-size: 24px;
            margin: 0;
            flex: 0 0 auto;
            line-height: 60px; /* Match navbar height */
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .search-input {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            padding: 8px 12px;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            outline: none;
            width: 200px;
            height: 36px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            transition: width 0.3s ease, background-color 0.3s ease;
        }

        .search-input:focus {
            background: rgba(255, 255, 255, 0.2);
            width: 250px;
        }

        .search-input::placeholder {
            color: rgba(255, 215, 0, 0.6);
        }

        #logoutButton {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            height: 36px;
            width: 36px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
        }

        #logoutButton:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Responsive Design Updates */
        @media (max-width: 768px) {
            .navbar-container {
                padding: 0 10px;
            }

            .navbar-title {
                left: 10px;
                font-size: 20px;
            }

            .search-input {
                width: 140px;
                left: 50%;
            }

            .search-input:focus {
                width: 180px;
            }

            #logoutButton {
                right: 10px;
            }
        }

        @media (max-width: 480px) {
            .search-input {
                width: 120px;
                font-size: 14px;
            }

            .search-input:focus {
                width: 150px;
            }
        }

        .wishlist-checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }

        .wishlist-checkbox-wrapper:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .wishlist-checkbox {
            width: 1.5rem;
            height: 1.5rem;
            cursor: pointer;
            accent-color: var(--primary-gradient);
        }

        .navbar-container {
            display: grid;
            grid-template-columns: auto 1fr auto auto;
            gap: 1rem;
            align-items: center;
            padding: 0 1rem;
        }

        .filter-button {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }

        .filter-button.active {
            background: var(--secondary-gradient);
            transform: scale(1.05);
        }

        .task-item.wishlist::before {
            content: 'üõçÔ∏è';
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 1.2rem;
            opacity: 0.7;
        }

        .cart-toggle {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px 10px;
            transition: transform 0.2s ease;
            opacity: 0.5;
        }
        
        .cart-toggle.active {
            opacity: 1;
        }
        
        .cart-toggle:hover {
            transform: scale(1.2);
        }

        /* Update task list styling for better visibility */
        #activeTasksList {
            max-height: 50vh; /* Limit height to half viewport height */
            overflow-y: auto; /* Enable scrolling if needed */
            margin-bottom: 2rem; /* Add space before the task form */
        }

        #activeTasksList:empty {
            display: none; /* Hide when no tasks are found */
        }

        /* Style scrollbar for better usability */
        #activeTasksList::-webkit-scrollbar {
            width: 8px;
        }

        #activeTasksList::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        #activeTasksList::-webkit-scrollbar-thumb {
            background: var(--primary-gradient);
            border-radius: 4px;
        }

        #activeTasksList::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-gradient);
        }

        /* Add styles for hashtag groups */
        .hashtag-group {
            border-left: 3px solid var(--blue-7);
            margin: 1.5rem 0;
            padding-left: 1rem;
        }

        .hashtag-header {
            color: var(--text-color);
            font-size: 1.2rem;
            margin-bottom: 1rem;
            opacity: 0.8;
        }

        /* Make hashtags in task text stand out */
        .task-text .hashtag {
            color: var(--blue-7);
            font-weight: 500;
        }

        /* Add styles for task numbering */
        .task-number {
            min-width: 2rem;
            text-align: right;
            padding-right: 1rem;
            color: var(--muted-text);
            font-size: 1rem;
            user-select: none;
        }

        .task-details {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
            min-width: 200px;
            position: relative;
        }

        /* Achievement Image Styling */
        .achievement-image {
            width: 100%;
            max-width: 800px;
            margin: 1rem auto;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease;
            order: 3; /* Place after active tasks but before task form */
        }

        .achievement-image img {
            max-width: 100%;
            height: auto;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .achievement-image.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Fixed Navbar -->
    <nav class="navbar">
        <div class="navbar-container">
            <h1 class="navbar-title"></h1>
            <input type="text" id="taskSearchInput" class="search-input" placeholder="Search tasks...">
            <button id="wishlistFilter" class="filter-button">üõçÔ∏è</button>
            <button id="logoutButton" aria-label="Log Out">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </nav>
    <!-- Confetti Container -->
    <div class="confetti-container" id="confettiContainer"></div>

    <!-- Login Container -->
    <div id="loginContainer">
        <h2>üîí Please Log In</h2>
        <button id="googleLoginButton" class="google-login-btn">
            <i class="fab fa-google"></i> Sign in with Google
        </button>
    </div>

    <!-- Main Application Container (Initially Hidden) -->
    <div class="container" id="appContainer" style="display: none;">
        
        <!-- Header Component -->
        <div class="header">
            <h1 class="title">epicTasks</h1>
        </div>

        <!-- Active Tasks List Component (Moved up) -->
        <div class="task-list" id="activeTasksList">
            <h3>Active Tasks</h3>
            <!-- Active tasks will be dynamically added here -->
        </div>

        <!-- Achievement Image Component -->
        <div id="achievementImage" class="achievement-image"></div>

        <!-- Task Form Component -->
        <div class="task-form">
            <input type="text" id="taskInput" placeholder="Enter your quest...">
            <select id="difficultySelect">
                <option value="1">5 pts</option>
                <option value="2">10 pts</option>
                <option value="3">15 pts</option>
                <option value="4">20 pts</option>
                <option value="5">25 pts</option>
                <option value="6">Other</option>
            </select>
            <input type="number" id="customPoints" placeholder="Enter points" min="1" max="100" style="display: none;">
            <label class="wishlist-checkbox-wrapper">
                <input type="checkbox" id="wishlistCheckbox" class="wishlist-checkbox">
                üõí
            </label>
            <button id="addTaskButton"><i class="fas fa-plus"></i> Add</button>
        </div>

        <!-- Stats Component -->
        <div class="stats">
            <div>
                <i class="fas fa-check-circle"></i>
                Completed: <span id="completedTasks" class="number-transition">0</span>
            </div>
            <div>
                <i class="fas fa-star"></i>
                Points: <span id="totalPoints" class="number-transition">0</span>
            </div>
            <div>
                <i class="fas fa-level-up-alt"></i>
                Level: <span id="level" class="number-transition">1</span>
            </div>
        </div>

        <!-- Progress Bar Component -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text">
                Progress to Next Level: <span id="progressText">0/100</span>
            </div>
        </div>
        
        <!-- Completed Tasks List Component -->
        <div class="task-list" id="completedTasksList">
            <h3>Completed Tasks</h3>
            <!-- Completed tasks will be dynamically added here -->
        </div>

        <!-- Reset Progress Button Component -->
        <button class="reset-button" id="resetButton"><i class="fas fa-redo-alt"></i> Reset Progress</button>
    </div>

    <!-- Confirmation Modal Component -->
    <div id="confirmModal" class="confirm-modal">
        <div class="confirm-modal-content">
            <p id="confirmMessage">Are you sure you want to reset all progress? ‚ò¢Ô∏è This action is irreversible!</p>
            <div class="confirm-modal-buttons">
                <button class="confirm" id="confirmYes"><i class="fas fa-check"></i> Yes</button>
                <button class="cancel" id="confirmNo"><i class="fas fa-times"></i> No</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs and Initialization -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-analytics.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, serverTimestamp, writeBatch } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            signInWithEmailAndPassword, 
            signOut, 
            setPersistence, 
            browserLocalPersistence,
            GoogleAuthProvider,
            signInWithPopup 
        } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyASqKkvoIp6qvX2Dvze5s6nfKBghQ41axQ",
            authDomain: "epic-task-quest.firebaseapp.com",
            projectId: "epic-task-quest",
            storageBucket: "epic-task-quest.appspot.com",
            messagingSenderId: "421446505180",
            appId: "1:421446505180:web:ac2270f8c0b92d16529a19",
            measurementId: "G-35SX22QFBS"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);
        const auth = getAuth(app);

        console.log("Firebase initialized successfully.");

        // ===========================
        // Authentication Logic
        // ===========================

        // DOM Elements for Login
        const loginContainer = document.getElementById('loginContainer');
        const appContainer = document.getElementById('appContainer');
        /*const emailInput = document.getElementById('emailInput');
        const passwordInput = document.getElementById('passwordInput');
        const loginButton = document.getElementById('loginButton');*/
        const loginError = document.getElementById('loginError');
        const googleLoginButton = document.getElementById('googleLoginButton');

        // Authorized Email
        const authorizedEmail = 'victordelrosal@gmail.com';

        // Initialize Google Auth Provider
        const googleProvider = new GoogleAuthProvider();

        // Set Authentication Persistence to Local
        setPersistence(auth, browserLocalPersistence)
            .then(() => {
                console.log("Authentication persistence set to LOCAL.");
                // Persistence is now set. You can proceed with other operations.
            })
            .catch((error) => {
                console.error("Error setting authentication persistence:", error);
            });

        // Login Function
        /*loginButton.addEventListener('click', () => {
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();

            if (email === "" || password === "") {
                loginError.textContent = "Please enter both email and password.";
                loginError.style.display = "block";
                return;
            }

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    // Signed in 
                    const user = userCredential.user;
                    console.log(`User ${user.email} signed in.`);
                    loginError.style.display = "none";
                    // The onAuthStateChanged listener will handle the UI toggle
                })
                .catch((error) => {
                    console.error("Error signing in:", error);
                    loginError.textContent = "Invalid credentials. Please try again.";
                    loginError.style.display = "block";
                });
        });
*/
        // Google Login Function
        googleLoginButton.addEventListener('click', () => {
            signInWithPopup(auth, googleProvider)
                .then((result) => {
                    // This gives you a Google Access Token
                    const credential = GoogleAuthProvider.credentialFromResult(result);
                    const token = credential.accessToken;
                    // The signed-in user info
                    const user = result.user;
                    
                    // Check if user's email is authorized
                    if (user.email === authorizedEmail) {
                        console.log("Google sign-in successful");
                        loginError.style.display = "none";
                    } else {
                        // Unauthorized user
                        signOut(auth);
                        loginError.textContent = "Unauthorized email address";
                        loginError.style.display = "block";
                    }
                })
                .catch((error) => {
                    console.error("Error during Google sign-in:", error);
                    loginError.textContent = "Google sign-in failed. Please try again.";
                    loginError.style.display = "block";
                });
        });

        // Logout Button
        const logoutButton = document.getElementById('logoutButton');

        logoutButton.addEventListener('click', () => {
            signOut(auth).then(() => {
                console.log("User signed out.");
            }).catch((error) => {
                console.error("Error signing out:", error);
            });
        });

        // Monitor Authentication State
        onAuthStateChanged(auth, (user) => {
            if (user) {
                if (user.email === authorizedEmail) {
                    // Show the main app
                    loginContainer.style.display = "none";
                    appContainer.style.display = "flex";
                    loadTasks(); // Load tasks only after authentication
                } else {
                    // Unauthorized user
                    loginContainer.innerHTML = `<h2 style="color: var(--error-color);">Unauthorized Access</h2>`;
                    console.warn(`User ${user.email} is not authorized to view this content.`);
                    // Optionally, you can sign out the unauthorized user
                    signOut(auth);
                }
            } else {
                // No user is signed in
                loginContainer.style.display = "flex";
                appContainer.style.display = "none";
            }
        });

        // ===========================
        // Initialize Global Variables
        // ===========================
        let tasks = [];
        let totalPoints = 0;
        let level = 1;
        let completedTasks = 0;
        const pointsToNextLevel = 100;

        // DOM Elements
        const taskInput = document.getElementById('taskInput');
        const difficultySelect = document.getElementById('difficultySelect');
        const customPointsInput = document.getElementById('customPoints');
        const addTaskButton = document.getElementById('addTaskButton');
        const activeTasksList = document.getElementById('activeTasksList');
        const completedTasksList = document.getElementById('completedTasksList');
        const completedTasksSpan = document.getElementById('completedTasks');
        const totalPointsSpan = document.getElementById('totalPoints');
        const levelSpan = document.getElementById('level');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const resetButton = document.getElementById('resetButton');
        const confirmModal = document.getElementById('confirmModal');
        const confirmYes = document.getElementById('confirmYes');
        const confirmNo = document.getElementById('confirmNo');
        const confettiContainer = document.getElementById('confettiContainer');
        const taskSearchInput = document.getElementById('taskSearchInput');
        const wishlistCheckbox = document.getElementById('wishlistCheckbox');
        const wishlistFilter = document.getElementById('wishlistFilter');
        let currentFilter = 'all';

        // Add achievement image URLs array
        const achievementImages = [
            'https://i.postimg.cc/d7qYLggG/1k.png',
            'https://i.postimg.cc/JGkmgNbH/2k.png',
            'https://i.postimg.cc/Fd65Czzx/3k.png',
            'https://i.postimg.cc/T5W8zxWv/4k.png',
            'https://i.postimg.cc/FYbvFhC9/5k.png',
            'https://i.postimg.cc/pygMDmgW/6k.png',
            'https://i.postimg.cc/vD1dgr22/7k.png',
            'https://i.postimg.cc/rD2cLDJn/8k.png',
            'https://i.postimg.cc/LqNMfNMw/9k.png',
            'https://i.postimg.cc/cgCGcwxH/10k.png',
            'https://i.postimg.cc/H8jWC0Rh/11k.png',
            'https://i.postimg.cc/4Ycdd5yC/12k.png',
            'https://i.postimg.cc/sB9gPg5w/13k.png',
            'https://i.postimg.cc/r0VFf2Jc/14k.png',
            'https://i.postimg.cc/r0fybZn4/15k.png',
            'https://i.postimg.cc/3WrdBmSp/16k.png',
            'https://i.postimg.cc/qt8zmLHc/17k.png',
            'https://i.postimg.cc/gnJLY83d/18k.png',
            'https://i.postimg.cc/rd6DCH3F/19k.png',
            'https://i.postimg.cc/Wq4z1cFS/20k.png',
            'https://i.postimg.cc/yJRT1NfX/21k.png',
            'https://i.postimg.cc/YjRzqZxV/22k.png',
            'https://i.postimg.cc/CBVszVXy/23k.png',
            'https://i.postimg.cc/6TthKtCn/24k.png',
            'https://i.postimg.cc/LnsBqDCs/25k.png',
            'https://i.postimg.cc/FkrbVVhD/26k.png',
            'https://i.postimg.cc/4nDT8gw9/27k.png',
            'https://i.postimg.cc/cvZGSBp1/28k.png',
            'https://i.postimg.cc/GHvnV5SS/29k.png',
            'https://i.postimg.cc/5X3dNFJB/30k.png',
            'https://i.postimg.cc/2LNq9Cy6/31k.png',
            'https://i.postimg.cc/dDGZkZNT/32k.png',
            'https://i.postimg.cc/7fVCX8kH/33k.png'
        ];

        // ===========================
        // Utility Functions
        // ===========================

        // Get points based on difficulty
        function getPoints(difficulty, customPoints) {
            const pointsMap = {
                1: 5,
                2: 10,
                3: 15,
                4: 20,
                5: 25,
                6: customPoints || 30 // Use stored custom points if available
            };
            return pointsMap[difficulty] || 5;
        }

        // Update stats display with animations
        function updateStats() {
            const prevTotalPoints = totalPoints;
            const prevLevel = level;
            const prevCompletedTasks = completedTasks;

            // Update stats
            completedTasksSpan.textContent = completedTasks;
            totalPointsSpan.textContent = totalPoints;

            // Calculate new level
            const newLevel = Math.floor(totalPoints / pointsToNextLevel) + 1;
            level = newLevel;
            levelSpan.textContent = level;

            // Update progress bar
            const progress = totalPoints % pointsToNextLevel;
            const progressPercentage = (progress / pointsToNextLevel) * 100;
            progressFill.style.width = `${progressPercentage}%`;
            progressText.textContent = `${progress}/${pointsToNextLevel}`;

            // Trigger Completed Tasks Animation if increased
            if (completedTasks > prevCompletedTasks) {
                animateCompletedTasks(completedTasksSpan);
            }

            // Trigger Points Counting Animation if increased
            if (totalPoints > prevTotalPoints) {
                animatePointsCount(totalPointsSpan, prevTotalPoints, totalPoints);
            }

            // Trigger Level Up Animation if level increased
            if (level > prevLevel) {
                animateLevelUp(levelSpan);
            }

            // Handle achievement image display
            if (level > prevLevel) {
                const imageIndex = ((level - 1) % achievementImages.length);
                const achievementContainer = document.getElementById('achievementImage');
                achievementContainer.innerHTML = `<img src="${achievementImages[imageIndex]}" alt="Level ${level} Achievement">`;
                achievementContainer.classList.remove('visible');
                // Force reflow
                void achievementContainer.offsetWidth;
                achievementContainer.classList.add('visible');
            }
        }

        // ===========================
        // Firestore Operations
        // ===========================

        // Load tasks from Firestore
        async function loadTasks() {
            try {
                const querySnapshot = await getDocs(collection(db, "tasks"));
                tasks = [];
                completedTasks = 0;
                totalPoints = 0;

                querySnapshot.forEach((docSnap) => {
                    const task = { id: docSnap.id, ...docSnap.data() };
                    tasks.push(task);
                    if (task.completed) {
                        completedTasks++;
                        totalPoints += getPoints(task.difficulty, task.customPoints);
                    }
                });

                level = Math.floor(totalPoints / pointsToNextLevel) + 1;
                updateStats();
                renderTasks();
                console.log("Tasks loaded successfully from Firestore.");
            } catch (error) {
                console.error("Error loading tasks: ", error);
            }
        }

        // Add a new task to Firestore
        async function addTask() {
            const text = taskInput.value.trim();
            const difficulty = parseInt(difficultySelect.value);
            const customPoints = difficulty === 6 ? 
                (parseInt(document.getElementById('customPoints').value) || 30) : 
                null;
            const isWishlist = wishlistCheckbox.checked;

            if (text === "") {
                alert("Please enter a task.");
                return;
            }

            // Get active tasks count
            const activeTasks = tasks.filter(t => !t.completed).length;
            
            // Get custom position from task text if it starts with a number
            let position = null;
            const numberMatch = text.match(/^(\d+)[.:\s-]+(.+)/);
            if (numberMatch) {
                position = parseInt(numberMatch[1]);
                // Adjust text to remove the number prefix
                text = numberMatch[2].trim();
            }

            // If position is greater than current list size + 1, add to end
            if (position > activeTasks + 1) {
                position = activeTasks + 1;
            }

            const task = {
                text,
                difficulty,
                customPoints,
                completed: false,
                timestamp: serverTimestamp(),
                isWishlist: isWishlist,
                position: position || activeTasks + 1
            };

            try {
                const docRef = await addDoc(collection(db, "tasks"), task);
                console.log("Task added with ID: ", docRef.id);
                task.id = docRef.id;
                
                // Insert task at the correct position
                if (position) {
                    tasks.splice(position - 1, 0, task);
                } else {
                    tasks.unshift(task);
                }
                
                renderTasks();
                animateTaskAddition(docRef.id);
                
                // Reset form
                taskInput.value = "";
                difficultySelect.value = "1"; // Reset to default difficulty
                document.getElementById('customPoints').style.display = 'none';
                document.getElementById('customPoints').value = '';
                wishlistCheckbox.checked = false;
            } catch (error) {
                console.error("Error adding task: ", error);
            }
        }

        // Toggle task completion
        async function toggleTaskCompletion(taskId, completed) {
            try {
                const taskDoc = doc(db, "tasks", taskId);
                await updateDoc(taskDoc, { completed: completed });
                console.log(`Task ${taskId} marked as ${completed ? 'completed' : 'active'}.`);
                loadTasks(); // Reload tasks to update stats and trigger animations

                if (completed) {
                    triggerConfetti();
                }
            } catch (error) {
                console.error("Error updating task: ", error);
            }
        }

        // Edit task text
        async function editTaskText(taskId, newText) {
            if (newText.trim() === "") {
                alert("Task text cannot be empty.");
                loadTasks(); // Reload to reset changes
                return;
            }

            try {
                const taskDoc = doc(db, "tasks", taskId);
                await updateDoc(taskDoc, { text: newText });
                console.log(`Task ${taskId} text updated.`);
                
                // Re-render tasks immediately to show new hashtag grouping
                const taskIndex = tasks.findIndex(t => t.id === taskId);
                if (taskIndex !== -1) {
                    tasks[taskIndex].text = newText;
                    renderTasks(tasks); // Re-render with updated task
                }
            } catch (error) {
                console.error("Error editing task: ", error);
            }
        }

        // Update task difficulty
        async function updateTaskDifficulty(taskId, newDifficulty) {
            try {
                const taskDoc = doc(db, "tasks", taskId);
                await updateDoc(taskDoc, { difficulty: newDifficulty });
                console.log(`Task ${taskId} difficulty updated to ${newDifficulty}.`);
                loadTasks(); // Reload tasks to update UI and trigger animations
            } catch (error) {
                console.error("Error updating task difficulty: ", error);
            }
        }

        // Delete a task
        async function deleteTask(taskId) {
            try {
                await deleteDoc(doc(db, "tasks", taskId));
                console.log(`Task ${taskId} deleted.`);
                animateTaskDeletion(taskId);
                loadTasks(); // Reload tasks to update list and stats
            } catch (error) {
                console.error("Error deleting task: ", error);
            }
        }

        // Reset all progress
        async function resetProgress() {
            try {
                const querySnapshot = await getDocs(collection(db, "tasks"));
                const batch = writeBatch(db);

                querySnapshot.forEach((docSnap) => {
                    batch.delete(doc(db, "tasks", docSnap.id));
                });

                await batch.commit();
                console.log("All tasks deleted successfully.");
                loadTasks(); // Reload tasks to reflect changes
            } catch (error) {
                console.error("Error resetting progress: ", error);
            }
        }

        // ===========================
        // Firestore Update for Custom Points
        // ===========================

        // Add function to update custom points
        async function updateTaskCustomPoints(taskId, newCustomPoints) {
            try {
                const taskDoc = doc(db, "tasks", taskId);
                const points = parseInt(newCustomPoints) || 30;
                await updateDoc(taskDoc, { 
                    customPoints: points,
                    difficulty: 6  // Ensure difficulty stays at 6 for custom points
                });
                console.log(`Task ${taskId} custom points updated to ${points}.`);
                loadTasks(); // Reload tasks to update UI and trigger animations
            } catch (error) {
                console.error("Error updating task custom points: ", error);
            }
        }

        // ===========================
        // Render Tasks to the DOM
        // ===========================

        // Extract hashtags from text
        function extractHashtags(text) {
            const hashtagRegex = /#[\w\u0590-\u05ff]+/g;
            return text.match(hashtagRegex) || [];
        }

        // Group tasks by hashtags
        function groupTasksByHashtags(tasks) {
            const groups = new Map();
            const noHashtagGroup = [];

            tasks.forEach(task => {
                const hashtags = extractHashtags(task.text);
                if (hashtags.length === 0) {
                    noHashtagGroup.push(task);
                } else {
                    // Add task to each of its hashtag groups
                    hashtags.forEach(tag => {
                        if (!groups.has(tag)) {
                            groups.set(tag, []);
                        }
                        groups.set(tag, [...groups.get(tag), task]);
                    });
                }
            });

            // Sort each group by points
            groups.forEach((tasks, tag) => {
                tasks.sort((a, b) => {
                    const pointsA = getPoints(a.difficulty, a.customPoints);
                    const pointsB = getPoints(b.difficulty, b.customPoints);
                    return pointsB - pointsA;
                });
            });

            // Convert to sorted array of groups
            const sortedGroups = Array.from(groups.entries())
                .sort(([tagA], [tagB]) => tagA.localeCompare(tagB));

            return { sortedGroups, noHashtagGroup };
        }

        function renderTasks(filteredTasks = tasks) {
            // Clear existing tasks
            activeTasksList.innerHTML = `<h3>Active Tasks</h3>`;
            completedTasksList.innerHTML = `<h3>Completed Tasks</h3>`;

            // Separate active and completed tasks
            const activeTasks = filteredTasks.filter(task => !task.completed);
            const completedTasksArr = filteredTasks.filter(task => task.completed);

            // Group active tasks by hashtags
            const { sortedGroups, noHashtagGroup } = groupTasksByHashtags(activeTasks);

            // Render hashtag groups
            let activeNumber = 1;
            sortedGroups.forEach(([tag, tasks]) => {
                const groupDiv = document.createElement('div');
                groupDiv.classList.add('hashtag-group');
                
                const headerDiv = document.createElement('div');
                headerDiv.classList.add('hashtag-header');
                headerDiv.textContent = tag;
                groupDiv.appendChild(headerDiv);

                tasks.forEach(task => {
                    const taskItem = createTaskElement(task, false, activeNumber++);
                    groupDiv.appendChild(taskItem);
                });

                activeTasksList.appendChild(groupDiv);
            });

            // Render tasks without hashtags
            if (noHashtagGroup.length > 0) {
                const groupDiv = document.createElement('div');
                groupDiv.classList.add('hashtag-group');
                
                const headerDiv = document.createElement('div');
                headerDiv.classList.add('hashtag-header');
                headerDiv.textContent = 'Other Tasks';
                groupDiv.appendChild(headerDiv);

                noHashtagGroup
                    .sort((a, b) => getPoints(b.difficulty, b.customPoints) - getPoints(a.difficulty, a.customPoints))
                    .forEach(task => {
                        const taskItem = createTaskElement(task, false, activeNumber++);
                        groupDiv.appendChild(taskItem);
                    });

                activeTasksList.appendChild(groupDiv);
            }

            // Render Completed Tasks (unchanged)
            let completedNumber = 1;
            completedTasksArr
                .sort((a, b) => getPoints(b.difficulty, b.customPoints) - getPoints(a.difficulty, a.customPoints))
                .forEach(task => {
                    const taskItem = createTaskElement(task, true, completedNumber++);
                    completedTasksList.appendChild(taskItem);
                });
        }

        // Update task text to highlight hashtags
        function highlightHashtags(text) {
            return text.replace(/(#[\w\u0590-\u05ff]+)/g, '<span class="hashtag">$1</span>');
        }

        // Create a task element
        function createTaskElement(task, isCompleted, number) {
            const taskItem = document.createElement('div');
            taskItem.classList.add('task-item');
            taskItem.setAttribute('data-id', task.id);
            taskItem.setAttribute('data-priority', task.priority);

            // Task Details
            const taskDetails = document.createElement('div');
            taskDetails.classList.add('task-details');

            // Add task number
            const taskNumber = document.createElement('span');
            taskNumber.classList.add('task-number');
            taskNumber.textContent = `${number}.`;
            taskDetails.appendChild(taskNumber);

            // Checkbox
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.checked = isCompleted;
            checkbox.disabled = isCompleted; // Disable checkbox for completed tasks
            checkbox.addEventListener('change', () => {
                toggleTaskCompletion(task.id, checkbox.checked);
            });

            // Task Text
            const taskText = document.createElement('input');
            taskText.type = 'text';
            taskText.value = task.text;
            taskText.classList.add('task-text');
            if (isCompleted) {
                taskText.classList.add('completed');
            }
            taskText.disabled = isCompleted;

            // Add event listeners for editing
            taskText.addEventListener('blur', () => {
                if (taskText.value !== task.text) {
                    editTaskText(task.id, taskText.value);
                }
            });

            // Add keypress listener for Enter key
            taskText.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' || e.keyCode === 13) {
                    e.preventDefault();
                    taskText.blur(); // Trigger blur event to save changes
                }
            });

            // Add input event listener to show hashtag suggestions
            taskText.addEventListener('input', (e) => {
                const cursorPosition = e.target.selectionStart;
                const text = e.target.value;
                
                // Check if we're typing a hashtag
                if (text[cursorPosition - 1] === '#') {
                    // Show hashtag suggestions from existing tags
                    showHashtagSuggestions(e.target);
                }
            });

            taskDetails.appendChild(checkbox);
            taskDetails.appendChild(taskText);

            // Task Actions
            const taskActions = document.createElement('div');
            taskActions.classList.add('task-actions');

            if (!isCompleted) {  // Only add shopping cart toggle for active tasks
                // Add shopping cart toggle
                const cartToggle = document.createElement('button');
                cartToggle.innerHTML = task.isWishlist ? 'üõí' : '‚òê';
                cartToggle.title = 'Toggle Shopping List';
                cartToggle.classList.add('cart-toggle');
                cartToggle.style.fontSize = '1.3rem';
                if (task.isWishlist) {
                    cartToggle.classList.add('active');
                }
                
                cartToggle.addEventListener('click', async () => {
                    try {
                        const taskDoc = doc(db, "tasks", task.id);
                        await updateDoc(taskDoc, { 
                            isWishlist: !task.isWishlist 
                        });
                        cartToggle.innerHTML = !task.isWishlist ? 'üõí' : '‚òê';
                        cartToggle.classList.toggle('active');
                        task.isWishlist = !task.isWishlist;

                        // Refresh the task list if we're currently filtering by wishlist
                        if (currentFilter === 'wishlist') {
                            filterTasks(taskSearchInput.value);
                        }
                    } catch (error) {
                        console.error("Error updating wishlist status:", error);
                    }
                });

                taskActions.appendChild(cartToggle);
            }

            // Difficulty Select
            const difficultySelect = document.createElement('select');
            [1, 2, 3, 4, 5, 6].forEach(num => {
                const option = document.createElement('option');
                option.value = num;
                if (num === 6) {
                    // For Custom difficulty, just show the points
                    option.textContent = `${task.customPoints || 30}`;
                } else {
                    // For predefined difficulties, just show the points
                    option.textContent = `${getPoints(num)}`;
                }
                if (num === task.difficulty) option.selected = true;
                difficultySelect.appendChild(option);
            });

            // Custom points input
            const customPointsInput = document.createElement('input');
            customPointsInput.type = 'number';
            customPointsInput.min = '1';
            customPointsInput.max = '100';
            customPointsInput.placeholder = 'Enter points';
            customPointsInput.className = 'custom-points';
            customPointsInput.style.display = task.difficulty === 6 ? 'block' : 'none';
            customPointsInput.value = task.customPoints || '';
            customPointsInput.disabled = isCompleted;

            // Add event listener for custom points changes
            customPointsInput.addEventListener('change', () => {
                updateTaskCustomPoints(task.id, customPointsInput.value)
                    .then(() => {
                        // Only sort after custom points have been set
                        loadTasks();
                    });
            });

            difficultySelect.addEventListener('change', () => {
                const difficulty = parseInt(difficultySelect.value);
                customPointsInput.style.display = difficulty === 6 ? 'block' : 'none';
                
                if (difficulty !== 6) {
                    // Only update difficulty and sort when switching away from custom
                    updateTaskDifficulty(task.id, difficulty);
                } else {
                    // Just update difficulty without sorting when switching to custom
                    const taskDoc = doc(db, "tasks", task.id);
                    updateDoc(taskDoc, { difficulty: difficulty });
                }
            });

            // Delete Button
            const deleteButton = document.createElement('button');
            deleteButton.innerHTML = '<i class="fas fa-trash"></i>';
            deleteButton.title = 'Delete Task';
            deleteButton.addEventListener('click', () => {
                deleteTask(task.id);
            });

            // Append actions
            taskActions.appendChild(difficultySelect);
            taskActions.appendChild(customPointsInput);
            if (!isCompleted) {
                taskActions.appendChild(deleteButton);
            }

            // Apply completed styles
            if (isCompleted) {
                taskText.classList.add('completed');
            }

            // Append to task item
            taskItem.appendChild(taskDetails);
            taskItem.appendChild(taskActions);

            return taskItem;
        }

        // Add hashtag suggestions functionality
        function showHashtagSuggestions(inputElement) {
            // Get all existing hashtags
            const allHashtags = new Set();
            tasks.forEach(task => {
                const hashtags = extractHashtags(task.text);
                hashtags.forEach(tag => allHashtags.add(tag));
            });

            // Create suggestions dropdown if it doesn't exist
            let suggestionsDiv = document.getElementById('hashtag-suggestions');
            if (!suggestionsDiv) {
                suggestionsDiv = document.createElement('div');
                suggestionsDiv.id = 'hashtag-suggestions';
                suggestionsDiv.style.position = 'absolute';
                suggestionsDiv.style.background = 'var(--card-background)';
                suggestionsDiv.style.border = '1px solid var(--blue-7)';
                suggestionsDiv.style.borderRadius = 'var(--border-radius)';
                suggestionsDiv.style.maxHeight = '200px';
                suggestionsDiv.style.overflow = 'auto';
                suggestionsDiv.style.zIndex = '1000';
                document.body.appendChild(suggestionsDiv);
            }

            // Position the suggestions below the input
            const rect = inputElement.getBoundingClientRect();
            suggestionsDiv.style.left = `${rect.left}px`;
            suggestionsDiv.style.top = `${rect.bottom + 5}px`;
            suggestionsDiv.style.width = `${rect.width}px`;

            // Add suggestions
            suggestionsDiv.innerHTML = '';
            allHashtags.forEach(tag => {
                const suggestion = document.createElement('div');
                suggestion.textContent = tag;
                suggestion.style.padding = '0.5rem 1rem';
                suggestion.style.cursor = 'pointer';
                suggestion.style.color = 'var(--text-color)';
                suggestion.style.transition = 'background-color 0.2s';

                suggestion.addEventListener('mouseenter', () => {
                    suggestion.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
                });

                suggestion.addEventListener('mouseleave', () => {
                    suggestion.style.backgroundColor = 'transparent';
                });

                suggestion.addEventListener('click', () => {
                    const cursorPosition = inputElement.selectionStart;
                    const textBeforeCursor = inputElement.value.substring(0, cursorPosition);
                    const textAfterCursor = inputElement.value.substring(cursorPosition);
                    const lastHashIndex = textBeforeCursor.lastIndexOf('#');
                    inputElement.value = textBeforeCursor.substring(0, lastHashIndex) + tag + textAfterCursor;
                    inputElement.focus();
                    inputElement.setSelectionRange(cursorPosition + tag.length - (textBeforeCursor.length - lastHashIndex - 1), cursorPosition + tag.length - (textBeforeCursor.length - lastHashIndex - 1));
                    suggestionsDiv.style.display = 'none';
                });

                suggestionsDiv.appendChild(suggestion);
            });

            // Show suggestions
            suggestionsDiv.style.display = 'block';

            // Hide suggestions when clicking outside
            document.addEventListener('click', (e) => {
                if (!suggestionsDiv.contains(e.target) && e.target !== inputElement) {
                    suggestionsDiv.style.display = 'none';
                }
            }, { once: true });
        }

        // ===========================
        // Event Listeners
        // ===========================

        // Add Task Button Click
        addTaskButton.addEventListener('click', addTask);

        // Task Search Input Event Listener
        taskSearchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            filterTasks(searchTerm);
        });

        // Add Task Input Event Listeners
        taskInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' || e.keyCode === 13) {
                e.preventDefault(); // Prevent default form submission
                addTask();
            }
        });

        // Reset Button Click
        resetButton.addEventListener('click', () => {
            // Show confirmation modal
            confirmModal.style.display = 'block';
        });

        // Confirm Yes Button
        confirmYes.addEventListener('click', () => {
            resetProgress();
            confirmModal.style.display = 'none';
        });

        // Confirm No Button
        confirmNo.addEventListener('click', () => {
            confirmModal.style.display = 'none';
        });

        // Close Modal when clicking outside the content
        window.addEventListener('click', (event) => {
            if (event.target === confirmModal) {
                confirmModal.style.display = 'none';
            }
        });

        // Add this to your existing event listeners section
        wishlistFilter.addEventListener('click', () => {
            currentFilter = currentFilter === 'wishlist' ? 'all' : 'wishlist';
            wishlistFilter.classList.toggle('active', currentFilter === 'wishlist');
            filterTasks();
        });

        // ===========================
        // Initialize App
        // ===========================

        // The loadTasks function is called when the user is authenticated in the onAuthStateChanged listener.

        // ===========================
        // Animation Functions
        // ===========================

        // Function to animate Completed Tasks
        function animateCompletedTasks(element) {
            element.classList.add('pulse');
            element.addEventListener('animationend', function handleAnimationEnd() {
                element.classList.remove('pulse');
                element.removeEventListener('animationend', handleAnimationEnd);
            });
        }

        // Function to animate Points Counting
        function animatePointsCount(element, from, to) {
            const duration = 1000; // Duration in milliseconds
            let start = null;
            const step = timestamp => {
                if (!start) start = timestamp;
                const progress = timestamp - start;
                const current = Math.min(Math.floor(progress / duration * (to - from) + from), to);
                element.textContent = current;
                if (progress < duration) {
                    window.requestAnimationFrame(step);
                } else {
                    element.textContent = to;
                }
            };
            window.requestAnimationFrame(step);
        }

        // Function to animate Level Up
        function animateLevelUp(element) {
            // Add shine effect
            element.classList.add('shine');
            element.addEventListener('animationend', function handleAnimationEnd() {
                element.classList.remove('shine');
                element.removeEventListener('animationend', handleAnimationEnd);
            });

            // Show Level Up Badge
            showLevelUpBadge(element);
        }

        // Function to show Level Up Badge
        function showLevelUpBadge(element) {
            const badge = document.createElement('div');
            badge.classList.add('level-up-badge');
            badge.textContent = 'üéâ Level Up!';
            element.parentElement.appendChild(badge);

            // Remove badge after animation
            badge.addEventListener('animationend', () => {
                badge.remove();
            });
        }

        // Animate task addition with optional flash
        function animateTaskAddition(taskId) {
            const taskElement = document.querySelector(`.task-item[data-id="${taskId}"]`);
            if (taskElement) {
                taskElement.style.transform = 'scale(0.9)';
                taskElement.style.opacity = '0';
                setTimeout(() => {
                    taskElement.style.transition = `transform 0.3s ease, opacity 0.3s ease`;
                    taskElement.style.transform = 'scale(1)';
                    taskElement.style.opacity = '1';
                }, 100);

                // Flash the stats container to highlight the update
                const statsContainer = document.querySelector('.stats');
                statsContainer.classList.add('flash');
                statsContainer.addEventListener('animationend', function handleFlashEnd() {
                    statsContainer.classList.remove('flash');
                    statsContainer.removeEventListener('animationend', handleFlashEnd);
                });
            }
        }

        // Animate task deletion
        function animateTaskDeletion(taskId) {
            const taskElement = document.querySelector(`.task-item[data-id="${taskId}"]`);
            if (taskElement) {
                taskElement.style.transform = 'scale(0.9)';
                taskElement.style.opacity = '0';
                setTimeout(() => {
                    taskElement.remove();
                }, 300);
            }
        }

        // ===========================
        // Confetti Animation
        // ===========================

        function triggerConfetti() {
            const confettiColors = ['#FFD700', '#FFC300', '#FFEA00', '#FFF700', '#FFDD00', '#FFC100', '#FFB700']; // Various shades of gold
            const numberOfConfetti = 200; // Increased number for more generous effect

            for (let i = 0; i < numberOfConfetti; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.backgroundColor = confettiColors[Math.floor(Math.random() * confettiColors.length)];
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.top = `${Math.random() * -100}px`;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                const size = Math.random() * 8 + 4; // Sizes between 4px and 12px
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                confetti.style.opacity = Math.random() * 0.5 + 0.5; // Opacity between 0.5 and 1
                confettiContainer.appendChild(confetti);

                // Remove confetti after animation
                confetti.addEventListener('animationend', () => {
                    confetti.remove();
                });
            }
        }

        // ===========================
        // Responsive Task Form Handling
        // ===========================

        // Add event listener for the main form's difficulty select
        document.getElementById('difficultySelect').addEventListener('change', (e) => {
            const customPointsInput = document.getElementById('customPoints');
            if (e.target.value === '6') {
                customPointsInput.style.display = 'block';
                customPointsInput.value = '30'; // Set default value
                customPointsInput.focus(); // Optional: automatically focus the input
            } else {
                customPointsInput.style.display = 'none';
                customPointsInput.value = ''; // Clear the value when not using custom
            }
        });

        // Filter tasks based on search term
        function filterTasks(searchTerm = '') {
            let filteredTasks = tasks;
            
            // Apply search filter
            if (searchTerm) {
                filteredTasks = filteredTasks.filter(task => 
                    task.text.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }
            
            // Apply wishlist filter
            if (currentFilter === 'wishlist') {
                filteredTasks = filteredTasks.filter(task => task.isWishlist);
            }
            
            // Clear and update active tasks list first
            activeTasksList.innerHTML = `<h3>${currentFilter === 'wishlist' ? 'üõí Shopping List' : 'Active Tasks'}</h3>`;
            
            // Sort and display active tasks
            const activeTasks = filteredTasks.filter(task => !task.completed);
            activeTasks
                .sort((a, b) => getPoints(b.difficulty, b.customPoints) - getPoints(a.difficulty, a.customPoints))
                .forEach((task, index) => {
                    const taskItem = createTaskElement(task, false, index + 1);
                    activeTasksList.appendChild(taskItem);
                });
                
            // Update completed tasks separately
            const completedTasksArr = filteredTasks.filter(task => task.completed);
            completedTasksList.innerHTML = `<h3>Completed Tasks</h3>`;
            completedTasksArr.forEach((task, index) => {
                const taskItem = createTaskElement(task, true, index + 1);
                completedTasksList.appendChild(taskItem);
            });
        }
    </script>
</body>
</html>
